<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>í•™ìƒ í™”ë©´</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, onSnapshot, updateDoc } 
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ğŸ”‘ Firebase ì„¤ì • (êµì‚¬ìš©ê³¼ ë™ì¼í•˜ê²Œ êµì²´)
    const firebaseConfig = {
        apiKey: "AIzaSyD6EWEz8M1XtS9RBZwVamu2fpRrqHMdG0M",
        authDomain: "click-6bcfe.firebaseapp.com",
        projectId: "click-6bcfe",
        storageBucket: "click-6bcfe.firebasestorage.app",
        messagingSenderId: "1017935345719",
        appId: "1:1017935345719:web:f08d5041bc4e4de34aa7b2",
        measurementId: "G-R7MS8WD44W"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get("session");

    let myDocRef = null;

    async function joinSession() {
      const name = document.getElementById("studentName").value;
      if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");

      myDocRef = await addDoc(collection(db, "sessions", sessionId, "students"), {
        name: name,
        clicked: false
      });

      document.getElementById("joinArea").style.display = "none";
      document.getElementById("waiting").style.display = "block";

      // ì„¸ì…˜ ìƒíƒœ ê°ì‹œ
      onSnapshot(doc(db, "sessions", sessionId), (snap) => {
        if (snap.exists() && snap.data().status === "started") {
          document.getElementById("waiting").style.display = "none";
          document.getElementById("playArea").style.display = "block";
        }
      });
    }

    async function clickButton() {
      if (!myDocRef) return;
      await updateDoc(myDocRef, { clicked: true });
      alert("ë²„íŠ¼ì„ ëˆŒë €ìŠµë‹ˆë‹¤!");
    }

    window.joinSession = joinSession;
    window.clickButton = clickButton;
  </script>
</head>
<body>
  <h2>í•™ìƒ í™”ë©´</h2>
  <div id="joinArea">
    <input id="studentName" placeholder="ì´ë¦„ ì…ë ¥">
    <button onclick="joinSession()">ì…ì¥</button>
  </div>

  <div id="waiting" style="display:none;">
    <p>ëŒ€ê¸° ì¤‘... ì„ ìƒë‹˜ì´ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
  </div>

  <div id="playArea" style="display:none;">
    <button onclick="clickButton()">ë²„íŠ¼ ëˆ„ë¥´ê¸°</button>
  </div>
</body>
</html>
